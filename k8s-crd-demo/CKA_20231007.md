## CKA_20231007

### Startup a multiple nodes cluster

```shell
minikube start --nodes 2 -p cluster
minikube stop -p cluster
```

### Questions

- RBAC role

```shell
k create namespace topic-1

k create clusterrole deploy-role --verb=create --resource=deployment,daemonset,statefulset -n topic-1
k create sa cicd-token-user -n topic-1
k create rolebinding cicd-token-bind --clusterrole=deploy-role --serviceaccount=topic-1:cicd-token-user -n topic-1
k describe rolebinding cicd-token-bind -n topic-1

k create clusterrolebinding cicd-token-clusterrole-bind --clusterrole=deploy-role --serviceaccount=topic:cicd-token-user -n topic-1
k describe clusterrolebinding/cicd-token-clusterrole-bind
```

- safely-drain-node

```shell

```

- kubeadm-upgrade

```shell

```

- etcd backup and restore

```shell

```

- NetworkPolicy

```shell
k create namespace topic-5
k create namespace echo

k apply -f - <<EOF
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-port
  namespace: topic-5
spec:
  podSelector: {}
  policyTypes:
    - Ingress
#    - Egress
  ingress:
    - from:
        - namespaceSelector:
            matchLabels:
              project: echo
      ports:
        - protocol: TCP
          port: 9900
#  egress:
#    - to:
#        - ipBlock:
#            cidr: 10.0.0.0/24
#      ports:
#        - protocol: TCP
#          port: 5978
EOF
```

- deployment

```shell
k apply -f - <<EOF
apiVersion: v1
kind: Service
metadata:
  name: front-svc
spec:
  type: NodePort
  selector:
    app.kubernetes.io/name: nginx
  ports:
    - port: 80
      targetPort: 80
EOF
```

- the-ingress-resource

```shell
k apply -f - <<EOF
apiVersion: networking.k8s.io/v1
kind: IngressClass
metadata:
  labels:
    app.kubernetes.io/component: controller
  name: nginx-example
  annotations:
    ingressclass.kubernetes.io/is-default-class: "true"
spec:
  controller: k8s.io/ingress-nginx
EOF

k apply -f - <<EOF
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: ingress-topic-7
  namespace: topic-5
spec:
  ingressClassName: nginx-example
  rules:
  - http:
      paths:
      - path: /go
        pathType: Prefix
        backend:
          service:
            name: go
            port:
              number: 6686
EOF
```

- deployment replica
- assign-pods-nodes

```shell
https://kubernetes.io/docs/tasks/configure-pod-container/assign-pods-nodes/
https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/
```

- pv
```shell
https://kubernetes.io/docs/tasks/configure-pod-container/configure-persistent-volume-storage/#create-a-persistentvolume
```

- pvc

```shell
https://kubernetes.io/docs/concepts/storage/persistent-volumes/
https://kubernetes.io/docs/tasks/configure-pod-container/configure-persistent-volume-storage/
```
- pod logs

```shell
k logs -f <POD_NAME>
```

- sidecar

```shell

```

- resource

```shell
https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands

k top pod -l name=cpu-user --sort-by=cpu -A
```

- restart kubectl of a Node

```shell
systemctl status kubectl
systemctl restart kubectl
systemctl enable kubectl
```

### references
- https://mp.weixin.qq.com/s/SxmitpMMu6a91d3NqD5adQ
- https://minikube.sigs.k8s.io/docs/commands/addons/
- https://minikube.sigs.k8s.io/docs/tutorials/volume_snapshots_and_csi/
- https://blog.csdn.net/weixin_45310323/article/details/132650026
- https://kubernetes.io/docs/reference/kubectl/cheatsheet/
- http://kubernetes.io/docs/concepts/services-networking/ingress/#the-ingress-resource
- https://kubernetes.github.io/ingress-nginx/deploy/
